# GitHub Copilot Instructions for Watercrawl

## Project Overview
Watercrawl is a modular toolkit for validating and enriching South African flight-school datasets with evidence-backed research and POPIA-compliant contact handling. It emphasizes automation for analysts and GitHub Copilot integration via MCP.

## Architecture
- **Layered Design**: `firecrawl_demo.core` (config/utils), `firecrawl_demo.domain` (models/validation), `firecrawl_demo.application` (pipeline), `firecrawl_demo.integrations` (adapters/plugins), `firecrawl_demo.infrastructure` (persistence), `firecrawl_demo.interfaces` (CLI/MCP).
- **Data Flow**: Raw CSV → validation → enrichment via research adapters → compliance normalization → evidence logging → exports/lakehouse.
- **Extensibility**: Register new `ResearchAdapter` in `firecrawl_demo.integrations.adapters.research.registry` for additional data sources.

## Key Components
- **MCP Server**: JSON-RPC bridge for GitHub Copilot (`poetry run python -m app.cli mcp-server`). Exposes tasks like `summarize_last_run` (metrics snapshots) and `list_sanity_issues` (remediation queues) for pipeline health without parsing CSVs.
- **Research Adapters**: Implement `ResearchAdapter` protocol for data sources; register via `register_adapter()` in `firecrawl_demo.integrations.adapters.research.registry`. Feature-flagged (e.g., `FEATURE_ENABLE_FIRECRAWL_SDK` for live SDK).
- **Evidence Logging**: Appends to `data/interim/evidence_log.csv` with columns: RowID, Organisation, What changed, Sources (≥2 URLs, ≥1 official), Notes, Timestamp, Confidence (0–100).
- **Problems Reporting**: Aggregates linter/type/test errors into `problems_report.json` (via `scripts/collect_problems.py`). Check before changes; fix issues to enable clean enrichment.
- **Contracts**: Great Expectations + dbt suite in `analytics/`; run via `contracts` CLI command. Reports failing expectations for triage.
- **Lineage & Lakehouse**: Captures OpenLineage, PROV-O, DCAT artefacts; snapshots to Parquet with manifests in `data/versioning/`.
- **Infrastructure Planning**: `firecrawl_demo.infrastructure.planning` defines `InfrastructurePlan` with crawler, observability, policy, and plan→commit contracts.
- **Secrets Provider**: `firecrawl_demo.governance.secrets` supports Azure Key Vault or env vars for secure config.

## Key Workflows
- **Setup**: Use Poetry (`poetry install --no-root`). Python >=3.13 required.
- **CLI Commands**: Run via `poetry run python -m app.cli <command>`. Examples: `validate data/sample.csv`, `enrich data/sample.csv --output enriched.csv`, `contracts enriched.csv`.
- **QA**: `poetry run python -m dev.cli qa all` mirrors CI. Check `problems_report.json` (generated by `scripts/collect_problems.py`) for issues before changes.
- **Feature Flags**: Set `FEATURE_ENABLE_FIRECRAWL_SDK=1` and `FIRECRAWL_API_KEY` for live Firecrawl integration; defaults to offline deterministic mode.
- **Evidence Logging**: All changes append to `data/interim/evidence_log.csv` with RowID, Organisation, What changed, Sources, Notes, Timestamp, Confidence.

## Conventions
- **Dependencies**: Managed via `pyproject.toml` with Poetry; no `requirements.txt` needed. Export with `poetry export -f requirements.txt`.
- **Paths**: Defined in `firecrawl_demo.core.config` (e.g., `DATA_DIR = PROJECT_ROOT / "data"`).
- **Plugins**: Use `firecrawl_demo.integrations.integration_plugins` registry for adapters, telemetry, storage, contracts.
- **Testing**: `pytest` with coverage; includes Great Expectations + dbt contracts in `analytics/`.
- **Linting**: Ruff for Python; yamllint for YAML; markdownlint-cli2 for Markdown.
- **Secrets**: Via `firecrawl_demo.governance.secrets` provider (Azure Key Vault or env vars).

## Examples
- Enrich sample data: `poetry run python -m app.cli enrich data/sample.csv --output data/processed/enriched.csv`
- Run QA: `poetry run python -m dev.cli qa all --dry-run`
- Check problems: Read `problems_report.json` after running `scripts/collect_problems.py`

Reference: `docs/architecture.md`, `docs/cli.md`, `AGENTS.md` for analyst workflows.
</content>
<parameter name="filePath">/Users/jonathanbotha/GitHub/watercrawl/.github/copilot-instructions.md
